/*
 Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
  Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
 Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
  (https://github.com/101arrowz/fflate) for use in Troika text rendering. 
  Original licenses apply: 
  - fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
  - woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/
'use strict';(function(F,B){"object"===typeof exports&&"undefined"!==typeof module?B(exports,require("three"),require("troika-worker-utils"),require("bidi-js"),require("troika-three-utils")):"function"===typeof define&&define.amd?define(["exports","three","troika-worker-utils","bidi-js","troika-three-utils"],B):(F="undefined"!==typeof globalThis?globalThis:F||self,B(F.troika_three_text={},F.THREE,F.troika_worker_utils,F.bidi_js,F.troika_three_utils))})(this,function(F,B,Q,K,fa){function ja(l,f){ha=
!0;l=ka({},l);l.font=ua(l.font||R.defaultFontURL);l.text=""+l.text;l.sdfGlyphSize=l.sdfGlyphSize||R.sdfGlyphSize;if(null!=l.colorRanges){var u={};for(c in l.colorRanges)if(l.colorRanges.hasOwnProperty(c)){var m=l.colorRanges[c];"number"!==typeof m&&(m=va.set(m).getHex());u[c]=m}l.colorRanges=u}Object.freeze(l);u=R.textureWidth;var b=R.sdfExponent,a=l.sdfGlyphSize;var c=l.font+"@"+a;var d=aa[c];d||(d=aa[c]={sdfTexture:new B.DataTexture(new Uint8Array(a*u*4),u,a,B.RGBAFormat,void 0,void 0,void 0,void 0,
B.LinearFilter,B.LinearFilter)},d.sdfTexture.font=l.font);wa(l).then(function(c){c.newGlyphSDFs&&(c.newGlyphSDFs.forEach(function(b){var c=b.textureData,e=b.atlasIndex;for(b=d.sdfTexture.image;b.data.length<(e+1)*a*a;){var g=new Uint8Array(2*b.data.length);g.set(b.data);b.data=g;b.height*=2}g=Math.floor(e/4);var f=b.width/a;e=Math.floor(g/f)*b.width*a*4+g%f*a*4+e%4;for(g=0;g<a;g++){f=g*a;for(var l=e+g*b.width*4,p=0;p<a;p++)b.data[l+4*p]=c[f+p]}}),d.sdfTexture.needsUpdate=!0);f(Object.freeze({parameters:l,
sdfTexture:d.sdfTexture,sdfGlyphSize:a,sdfExponent:b,glyphBounds:c.glyphBounds,glyphAtlasIndices:c.glyphAtlasIndices,glyphColors:c.glyphColors,caretPositions:c.caretPositions,caretHeight:c.caretHeight,chunkedBounds:c.chunkedBounds,ascender:c.ascender,descender:c.descender,lineHeight:c.lineHeight,topBaseline:c.topBaseline,blockBounds:c.blockBounds,visibleBounds:c.visibleBounds,timings:c.timings,get totalBounds(){console.log("totalBounds deprecated, use blockBounds instead");return c.blockBounds},get totalBlockSize(){console.log("totalBlockSize deprecated, use blockBounds instead");
var a=c.blockBounds;return[a[2]-a[0],a[3]-a[1]]}}))})}function ka(l,f){for(var u in f)f.hasOwnProperty(u)&&(l[u]=f[u]);return l}function ua(l){Y||(Y="undefined"===typeof document?{}:document.createElement("a"));Y.href=l;return Y.href}function la(l){l=fa.createDerivedMaterial(l,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new B.Vector2},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new B.Vector4(0,
0,0,0)},uTroikaClipRect:{value:new B.Vector4(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new B.Vector2},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new B.Color},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new B.Matrix3},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nuniform float uTroikaDistanceOffset;\nuniform float uTroikaBlurRadius;\nuniform vec2 uTroikaPositionOffset;\nuniform float uTroikaCurveRadius;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec3 vTroikaGlyphColor;\nvarying vec2 vTroikaGlyphDimensions;\n",
vertexTransform:"\nvec4 bounds = aTroikaGlyphBounds;\nbounds.xz += uTroikaPositionOffset.x;\nbounds.yw -= uTroikaPositionOffset.y;\n\nvec4 outlineBounds = vec4(\n  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,\n  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius\n);\nvec4 clippedBounds = vec4(\n  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\n\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);\n\nfloat rad = uTroikaCurveRadius;\nif (rad != 0.0) {\n  float angle = position.x / rad;\n  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);\n  normal.xz = vec2(sin(angle), cos(angle));\n}\n  \nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n\nvTroikaGlyphUV = clippedXY.xy;\nvTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);\n\n\nfloat txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\nvec2 txStartUV = txUvPerSquare * vec2(\n  mod(floor(aTroikaGlyphIndex / 4.0), txCols),\n  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)\n);\nvTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);\nvTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);\n",
fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform float uTroikaSDFExponent;\nuniform float uTroikaDistanceOffset;\nuniform float uTroikaFillOpacity;\nuniform float uTroikaOutlineOpacity;\nuniform float uTroikaBlurRadius;\nuniform vec3 uTroikaStrokeColor;\nuniform float uTroikaStrokeWidth;\nuniform float uTroikaStrokeOpacity;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec2 vTroikaGlyphDimensions;\n\nfloat troikaSdfValueToSignedDistance(float alpha) {\n  // Inverse of encoding in SDFGenerator.js\n  \n  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);\n  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;\n  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);\n  return signedDist;\n}\n\nfloat troikaGlyphUvToSdfValue(vec2 glyphUV) {\n  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);\n  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);\n  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1\n  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;\n}\n\nfloat troikaGlyphUvToDistance(vec2 uv) {\n  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));\n}\n\nfloat troikaGetAADist() {\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;\n  #else\n  return vTroikaGlyphDimensions.x / 64.0;\n  #endif\n}\n\nfloat troikaGetFragDistValue() {\n  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);\n  float distance = troikaGlyphUvToDistance(clampedGlyphUV);\n \n  // Extrapolate distance when outside bounds:\n  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : \n    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);\n\n  \n\n  return distance;\n}\n\nfloat troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {\n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(-distanceOffset, -distance);\n  #else\n\n  float alpha = smoothstep(\n    distanceOffset + aaDist,\n    distanceOffset - aaDist,\n    distance\n  );\n  #endif\n\n  return alpha;\n}\n",
fragmentColorTransform:"\nfloat aaDist = troikaGetAADist();\nfloat distance = troikaGetFragDistValue();\nfloat edgeAlpha = uTroikaSDFDebug ?\n  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :\n  troikaGetEdgeAlpha(distance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));\n\n#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)\nvec4 fillRGBA = gl_FragColor;\nfillRGBA.a *= uTroikaFillOpacity;\nvec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);\nif (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;\ngl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(\n  -uTroikaStrokeWidth - aaDist,\n  -uTroikaStrokeWidth + aaDist,\n  distance\n));\ngl_FragColor.a *= edgeAlpha;\n#endif\n\nif (edgeAlpha == 0.0) {\n  discard;\n}\n",
customRewriter:function(f){var l=f.vertexShader;f=f.fragmentShader;var m=/\buniform\s+vec3\s+diffuse\b/;m.test(f)&&(f=f.replace(m,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),m.test(l)||(l=l.replace(fa.voidMainRegExp,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n")));return{vertexShader:l,fragmentShader:f}}});l.transparent=!0;Object.defineProperties(l,{isTroikaTextMaterial:{value:!0},shadowSide:{get:function(){return this.side},
set:function(){}}});return l}function xa(l){var f=ra.get(l);if(!f){var u=l.caretPositions,m=l.caretHeight;f=new Map;for(var b=0;b<u.length;b+=3){var a=u[b+2],c=f.get(a);c||f.set(a,c=[]);c.push({x:u[b],y:a,height:m,charIndex:b/3});b+3>=u.length&&c.push({x:u[b+1],y:a,height:m,charIndex:b/3+1})}}ra.set(l,f);return f}K=K&&"object"===typeof K&&"default"in K?K:{"default":K};var za=Q.defineWorkerModule({name:"Typr Font Parser",dependencies:[function(){return"undefined"==typeof window&&(self.window=self),
function(l){var f={parse:function(b){var a=f._bin;b=new Uint8Array(b);if("ttcf"==a.readASCII(b,0,4)){var c=4;a.readUshort(b,c);c+=2;a.readUshort(b,c);c+=2;var d=a.readUint(b,c);c+=4;for(var e=[],g=0;g<d;g++){var h=a.readUint(b,c);c+=4;e.push(f._readFont(b,h))}return e}return[f._readFont(b,0)]},_readFont:function(b,a){var c=f._bin,d=a;c.readFixed(b,a);a+=4;var e=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;var g="cmap;head;hhea;maxp;hmtx;name;OS/2;post;loca;glyf;kern;CFF ;GPOS;GSUB;SVG ".split(";");
d={_data:b,_offset:d};for(var h={},k=0;k<e;k++){var q=c.readASCII(b,a,4);a+=4;c.readUint(b,a);a+=4;var z=c.readUint(b,a);a+=4;var l=c.readUint(b,a);a+=4;h[q]={offset:z,length:l}}for(k=0;k<g.length;k++)a=g[k],h[a]&&(d[a.trim()]=f[a.trim()].parse(b,h[a].offset,h[a].length,d));return d},_tabOffset:function(b,a,c){var d=f._bin,e=d.readUshort(b,c+4);c+=12;for(var g=0;g<e;g++){var h=d.readASCII(b,c,4);c+=4;d.readUint(b,c);c+=4;var k=d.readUint(b,c);if(c+=4,d.readUint(b,c),c+=4,h==a)return k}return 0}};
f._bin={readFixed:function(b,a){return(b[a]<<8|b[a+1])+(b[a+2]<<8|b[a+3])/65540},readF2dot14:function(b,a){return f._bin.readShort(b,a)/16384},readInt:function(b,a){var c=f._bin.t.uint8;return c[0]=b[a+3],c[1]=b[a+2],c[2]=b[a+1],c[3]=b[a],f._bin.t.int32[0]},readInt8:function(b,a){return f._bin.t.uint8[0]=b[a],f._bin.t.int8[0]},readShort:function(b,a){var c=f._bin.t.uint8;return c[1]=b[a],c[0]=b[a+1],f._bin.t.int16[0]},readUshort:function(b,a){return b[a]<<8|b[a+1]},readUshorts:function(b,a,c){for(var d=
[],e=0;e<c;e++)d.push(f._bin.readUshort(b,a+2*e));return d},readUint:function(b,a){var c=f._bin.t.uint8;return c[3]=b[a],c[2]=b[a+1],c[1]=b[a+2],c[0]=b[a+3],f._bin.t.uint32[0]},readUint64:function(b,a){return 4294967296*f._bin.readUint(b,a)+f._bin.readUint(b,a+4)},readASCII:function(b,a,c){for(var d="",e=0;e<c;e++)d+=String.fromCharCode(b[a+e]);return d},readUnicode:function(b,a,c){for(var d="",e=0;e<c;e++){var g=b[a++]<<8|b[a++];d+=String.fromCharCode(g)}return d},_tdec:"undefined"!=typeof window&&
window.TextDecoder?new window.TextDecoder:null,readUTF8:function(b,a,c){var d=f._bin._tdec;return d&&0==a&&c==b.length?d.decode(b):f._bin.readASCII(b,a,c)},readBytes:function(b,a,c){for(var d=[],e=0;e<c;e++)d.push(b[a+e]);return d},readASCIIArray:function(b,a,c){for(var d=[],e=0;e<c;e++)d.push(String.fromCharCode(b[a+e]));return d}};f._bin.t={buff:new ArrayBuffer(8)};f._bin.t.int8=new Int8Array(f._bin.t.buff);f._bin.t.uint8=new Uint8Array(f._bin.t.buff);f._bin.t.int16=new Int16Array(f._bin.t.buff);
f._bin.t.uint16=new Uint16Array(f._bin.t.buff);f._bin.t.int32=new Int32Array(f._bin.t.buff);f._bin.t.uint32=new Uint32Array(f._bin.t.buff);f._lctf={};f._lctf.parse=function(b,a,c,d,e){var g=f._bin;c={};d=a;g.readFixed(b,a);a+=4;var h=g.readUshort(b,a);a+=2;var k=g.readUshort(b,a);a=g.readUshort(b,a+2);return c.scriptList=f._lctf.readScriptList(b,d+h),c.featureList=f._lctf.readFeatureList(b,d+k),c.lookupList=f._lctf.readLookupList(b,d+a,e),c};f._lctf.readLookupList=function(b,a,c){var d=f._bin,e=a,
g=[],h=d.readUshort(b,a);a+=2;for(var k=0;k<h;k++){var q=d.readUshort(b,a);a+=2;q=f._lctf.readLookupTable(b,e+q,c);g.push(q)}return g};f._lctf.readLookupTable=function(b,a,c){var d=f._bin,e=a,g={tabs:[]};g.ltype=d.readUshort(b,a);a+=2;g.flag=d.readUshort(b,a);a+=2;var h=d.readUshort(b,a);a+=2;for(var k=g.ltype,q=0;q<h;q++){var z=d.readUshort(b,a);a+=2;z=c(b,k,e+z,g);g.tabs.push(z)}return g};f._lctf.numOfOnes=function(b){for(var a=0,c=0;32>c;c++)0!=(b>>>c&1)&&a++;return a};f._lctf.readClassDef=function(b,
a){var c=f._bin,d=[],e=c.readUshort(b,a);if(a+=2,1==e){var g=c.readUshort(b,a);a+=2;var h=c.readUshort(b,a);a+=2;for(var k=0;k<h;k++)d.push(g+k),d.push(g+k),d.push(c.readUshort(b,a)),a+=2}if(2==e)for(e=c.readUshort(b,a),a+=2,k=0;k<e;k++)d.push(c.readUshort(b,a)),a+=2,d.push(c.readUshort(b,a)),a+=2,d.push(c.readUshort(b,a)),a+=2;return d};f._lctf.getInterval=function(b,a){for(var c=0;c<b.length;c+=3){var d=b[c],e=b[c+1];if(b[c+2],d<=a&&a<=e)return c}return-1};f._lctf.readCoverage=function(b,a){var c=
f._bin,d={};d.fmt=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);return a+=2,1==d.fmt&&(d.tab=c.readUshorts(b,a,e)),2==d.fmt&&(d.tab=c.readUshorts(b,a,3*e)),d};f._lctf.coverageIndex=function(b,a){var c=b.tab;return 1==b.fmt?c.indexOf(a):2==b.fmt&&(b=f._lctf.getInterval(c,a),-1!=b)?c[b+2]+(a-c[b]):-1};f._lctf.readFeatureList=function(b,a){var c=f._bin,d=a,e=[],g=c.readUshort(b,a);a+=2;for(var h=0;h<g;h++){var k=c.readASCII(b,a,4);a+=4;var q=c.readUshort(b,a);a+=2;q=f._lctf.readFeatureTable(b,d+q);
q.tag=k.trim();e.push(q)}return e};f._lctf.readFeatureTable=function(b,a){var c=f._bin,d=a,e={},g=c.readUshort(b,a);a+=2;0<g&&(e.featureParams=d+g);d=c.readUshort(b,a);a+=2;e.tab=[];for(g=0;g<d;g++)e.tab.push(c.readUshort(b,a+2*g));return e};f._lctf.readScriptList=function(b,a){var c=f._bin,d=a,e={},g=c.readUshort(b,a);a+=2;for(var h=0;h<g;h++){var k=c.readASCII(b,a,4);a+=4;var q=c.readUshort(b,a);a+=2;e[k.trim()]=f._lctf.readScriptTable(b,d+q)}return e};f._lctf.readScriptTable=function(b,a){var c=
f._bin,d=a,e={},g=c.readUshort(b,a);a+=2;e.default=f._lctf.readLangSysTable(b,d+g);g=c.readUshort(b,a);a+=2;for(var h=0;h<g;h++){var k=c.readASCII(b,a,4);a+=4;var q=c.readUshort(b,a);a+=2;e[k.trim()]=f._lctf.readLangSysTable(b,d+q)}return e};f._lctf.readLangSysTable=function(b,a){var c=f._bin,d={};c.readUshort(b,a);a+=2;d.reqFeature=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);return a+=2,d.features=c.readUshorts(b,a,e),d};f.CFF={};f.CFF.parse=function(b,a,c){var d=f._bin;(b=new Uint8Array(b.buffer,
a,c))[a=0];b[++a];b[++a];b[++a];a++;var e=[];a=f.CFF.readIndex(b,a,e);var g=[];for(c=0;c<e.length-1;c++)g.push(d.readASCII(b,a+e[c],e[c+1]-e[c]));a+=e[e.length-1];e=[];a=f.CFF.readIndex(b,a,e);g=[];for(c=0;c<e.length-1;c++)g.push(f.CFF.readDict(b,a+e[c],a+e[c+1]));a+=e[e.length-1];e=g[0];var h=[];a=f.CFF.readIndex(b,a,h);g=[];for(c=0;c<h.length-1;c++)g.push(d.readASCII(b,a+h[c],h[c+1]-h[c]));if(a+=h[h.length-1],f.CFF.readSubrs(b,a,e),e.CharStrings){a=e.CharStrings;h=[];a=f.CFF.readIndex(b,a,h);var k=
[];for(c=0;c<h.length-1;c++)k.push(d.readBytes(b,a+h[c],h[c+1]-h[c]));e.CharStrings=k}if(e.ROS){a=e.FDArray;h=[];a=f.CFF.readIndex(b,a,h);e.FDArray=[];for(c=0;c<h.length-1;c++)k=f.CFF.readDict(b,a+h[c],a+h[c+1]),f.CFF._readFDict(b,k,g),e.FDArray.push(k);a=e.FDSelect;e.FDSelect=[];c=b[a];if(a++,3!=c)throw c;h=d.readUshort(b,a);a+=2;for(c=0;c<h+1;c++)e.FDSelect.push(d.readUshort(b,a),b[a+2]),a+=3}return e.Encoding&&(e.Encoding=f.CFF.readEncoding(b,e.Encoding,e.CharStrings.length)),e.charset&&(e.charset=
f.CFF.readCharset(b,e.charset,e.CharStrings.length)),f.CFF._readFDict(b,e,g),e};f.CFF._readFDict=function(b,a,c){var d,e;for(e in a.Private&&(d=a.Private[1],a.Private=f.CFF.readDict(b,d,d+a.Private[0]),a.Private.Subrs&&f.CFF.readSubrs(b,d+a.Private.Subrs,a.Private)),a)-1!="FamilyName FontName FullName Notice version Copyright".split(" ").indexOf(e)&&(a[e]=c[a[e]-426+35])};f.CFF.readSubrs=function(b,a,c){var d=f._bin,e=[];a=f.CFF.readIndex(b,a,e);var g=e.length;c.Bias=1240>g?107:33900>g?1131:32768;
c.Subrs=[];for(g=0;g<e.length-1;g++)c.Subrs.push(d.readBytes(b,a+e[g],e[g+1]-e[g]))};f.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0];f.CFF.glyphByUnicode=function(b,a){for(var c=0;c<b.charset.length;c++)if(b.charset[c]==a)return c;return-1};f.CFF.glyphBySE=function(b,a){return 0>a||255<a?-1:f.CFF.glyphByUnicode(b,f.CFF.tableSE[a])};
f.CFF.readEncoding=function(b,a,c){f._bin;c=[".notdef"];var d=b[a];if(a++,0!=d)throw"error: unknown encoding format: "+d;d=b[a];a++;for(var e=0;e<d;e++)c.push(b[a+e]);return c};f.CFF.readCharset=function(b,a,c){var d=f._bin,e=[".notdef"],g=b[a];if(a++,0==g)for(var h=0;h<c;h++){var k=d.readUshort(b,a);a+=2;e.push(k)}else{if(1!=g&&2!=g)throw"error: format: "+g;for(;e.length<c;){k=d.readUshort(b,a);a+=2;var q=0;1==g?(q=b[a],a++):(q=d.readUshort(b,a),a+=2);for(h=0;h<=q;h++)e.push(k),k++}}return e};f.CFF.readIndex=
function(b,a,c){var d=f._bin,e=d.readUshort(b,a)+1,g=b[a+=2];if(a++,1==g)for(var h=0;h<e;h++)c.push(b[a+h]);else if(2==g)for(h=0;h<e;h++)c.push(d.readUshort(b,a+2*h));else if(3==g)for(h=0;h<e;h++)c.push(16777215&d.readUint(b,a+3*h-1));else if(1!=e)throw"unsupported offset size: "+g+", count: "+e;return a+e*g-1};f.CFF.getCharString=function(b,a,c){var d=f._bin,e=b[a],g=b[a+1];b[a+2];b[a+3];b[a+4];var h=1,k=null,q=null;20>=e&&(k=e,h=1);12==e&&(k=100*e+g,h=2);21<=e&&27>=e&&(k=e,h=1);28==e&&(q=d.readShort(b,
a+1),h=3);29<=e&&31>=e&&(k=e,h=1);32<=e&&246>=e&&(q=e-139,h=1);247<=e&&250>=e&&(q=256*(e-247)+g+108,h=2);251<=e&&254>=e&&(q=256*-(e-251)-g-108,h=2);255==e&&(q=d.readInt(b,a+1)/65535,h=5);c.val=null!=q?q:"o"+k;c.size=h};f.CFF.readCharString=function(b,a,c){c=a+c;for(var d=f._bin,e=[];a<c;){var g=b[a],h=b[a+1];b[a+2];b[a+3];b[a+4];var k=1,q=null,z=null;20>=g&&(q=g,k=1);12==g&&(q=100*g+h,k=2);19!=g&&20!=g||(q=g,k=2);21<=g&&27>=g&&(q=g,k=1);28==g&&(z=d.readShort(b,a+1),k=3);29<=g&&31>=g&&(q=g,k=1);32<=
g&&246>=g&&(z=g-139,k=1);247<=g&&250>=g&&(z=256*(g-247)+h+108,k=2);251<=g&&254>=g&&(z=256*-(g-251)-h-108,k=2);255==g&&(z=d.readInt(b,a+1)/65535,k=5);e.push(null!=z?z:"o"+q);a+=k}return e};f.CFF.readDict=function(b,a,c){for(var d=f._bin,e={},g=[];a<c;){var h=b[a],k=b[a+1];b[a+2];b[a+3];b[a+4];var q=1,z=null,l=null;if(28==h&&(l=d.readShort(b,a+1),q=3),29==h&&(l=d.readInt(b,a+1),q=5),32<=h&&246>=h&&(l=h-139,q=1),247<=h&&250>=h&&(l=256*(h-247)+k+108,q=2),251<=h&&254>=h&&(l=256*-(h-251)-k-108,q=2),255==
h)throw d.readInt(b,a+1),"unknown number";if(30==h){l=[];for(q=1;;){var p=b[a+q];q++;var n=p>>4;p&=15;if(15!=n&&l.push(n),15!=p&&l.push(p),15==p)break}n="";p=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"];for(var r=0;r<l.length;r++)n+=p[l[r]];l=parseFloat(n)}21>=h&&(z="version Notice FullName FamilyName Weight FontBBox BlueValues OtherBlues FamilyBlues FamilyOtherBlues StdHW StdVW escape UniqueID XUID charset Encoding CharStrings Private Subrs defaultWidthX nominalWidthX".split(" ")[h],
q=1,12==h)&&(z=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][k],q=2);null!=z?(e[z]=1==g.length?g[0]:
g,g=[]):g.push(l);a+=q}return e};f.cmap={};f.cmap.parse=function(b,a,c){b=new Uint8Array(b.buffer,a,c);a=0;c=f._bin;var d={};c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;var g=[];d.tables=[];for(var h=0;h<e;h++){var k=c.readUshort(b,a);a+=2;var q=c.readUshort(b,a);a+=2;var l=c.readUint(b,a);a+=4;var m="p"+k+"e"+q,p=g.indexOf(l);if(-1==p){var n;p=d.tables.length;g.push(l);var r=c.readUshort(b,l);0==r?n=f.cmap.parse0(b,l):4==r?n=f.cmap.parse4(b,l):6==r?n=f.cmap.parse6(b,l):12==r?n=f.cmap.parse12(b,
l):console.debug("unknown format: "+r,k,q,l);d.tables.push(n)}if(null!=d[m])throw"multiple tables for one platform+encoding";d[m]=p}return d};f.cmap.parse0=function(b,a){var c=f._bin,d={};d.format=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;d.map=[];for(c=0;c<e-6;c++)d.map.push(b[a+c]);return d};f.cmap.parse4=function(b,a){var c=f._bin,d=a,e={};e.format=c.readUshort(b,a);a+=2;var g=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;var h=c.readUshort(b,a);a+=2;h/=2;e.searchRange=
c.readUshort(b,a);a+=2;e.entrySelector=c.readUshort(b,a);a+=2;e.rangeShift=c.readUshort(b,a);a+=2;e.endCount=c.readUshorts(b,a,h);a=a+2*h+2;e.startCount=c.readUshorts(b,a,h);a+=2*h;e.idDelta=[];for(var k=0;k<h;k++)e.idDelta.push(c.readShort(b,a)),a+=2;e.idRangeOffset=c.readUshorts(b,a,h);a+=2*h;for(e.glyphIdArray=[];a<d+g;)e.glyphIdArray.push(c.readUshort(b,a)),a+=2;return e};f.cmap.parse6=function(b,a){var c=f._bin,d={};d.format=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=
2;d.firstCode=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;d.glyphIdArray=[];for(var g=0;g<e;g++)d.glyphIdArray.push(c.readUshort(b,a)),a+=2;return d};f.cmap.parse12=function(b,a){var c=f._bin,d={};d.format=c.readUshort(b,a);a=a+2+2;c.readUint(b,a);a+=4;c.readUint(b,a);a+=4;var e=c.readUint(b,a);a+=4;d.groups=[];for(var g=0;g<e;g++){var h=a+12*g,k=c.readUint(b,h+0),q=c.readUint(b,h+4);h=c.readUint(b,h+8);d.groups.push([k,q,h])}return d};f.glyf={};f.glyf.parse=function(b,a,c,d){b=[];for(a=0;a<
d.maxp.numGlyphs;a++)b.push(null);return b};f.glyf._parseGlyf=function(b,a){var c=f._bin,d=b._data,e=f._tabOffset(d,"glyf",b._offset)+b.loca[a];if(b.loca[a]==b.loca[a+1])return null;b={};if(b.noc=c.readShort(d,e),e+=2,b.xMin=c.readShort(d,e),e+=2,b.yMin=c.readShort(d,e),e+=2,b.xMax=c.readShort(d,e),e+=2,b.yMax=c.readShort(d,e),e+=2,b.xMin>=b.xMax||b.yMin>=b.yMax)return null;if(0<b.noc){b.endPts=[];for(a=0;a<b.noc;a++)b.endPts.push(c.readUshort(d,e)),e+=2;a=c.readUshort(d,e);if(e+=2,d.length-e<a)return null;
b.instructions=c.readBytes(d,e,a);e+=a;var g=b.endPts[b.noc-1]+1;b.flags=[];for(a=0;a<g;a++){var h=d[e];if(e++,b.flags.push(h),0!=(8&h)){var k=d[e];e++;for(var q=0;q<k;q++)b.flags.push(h),a++}}b.xs=[];for(a=0;a<g;a++)h=0!=(2&b.flags[a]),k=0!=(16&b.flags[a]),h?(b.xs.push(k?d[e]:-d[e]),e++):k?b.xs.push(0):(b.xs.push(c.readShort(d,e)),e+=2);b.ys=[];for(a=0;a<g;a++)h=0!=(4&b.flags[a]),k=0!=(32&b.flags[a]),h?(b.ys.push(k?d[e]:-d[e]),e++):k?b.ys.push(0):(b.ys.push(c.readShort(d,e)),e+=2);for(a=e=d=0;a<
g;a++)d+=b.xs[a],e+=b.ys[a],b.xs[a]=d,b.ys[a]=e}else{b.parts=[];do a=c.readUshort(d,e),e+=2,g={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1},(b.parts.push(g),g.glyphIndex=c.readUshort(d,e),e+=2,1&a)?(h=c.readShort(d,e),e+=2,k=c.readShort(d,e),e+=2):(h=c.readInt8(d,e),e++,k=c.readInt8(d,e),e++),2&a?(g.m.tx=h,g.m.ty=k):(g.p1=h,g.p2=k),8&a?(g.m.a=g.m.d=c.readF2dot14(d,e),e+=2):64&a?(g.m.a=c.readF2dot14(d,e),e+=2,g.m.d=c.readF2dot14(d,e),e+=2):128&a&&(g.m.a=c.readF2dot14(d,e),e+=2,g.m.b=c.readF2dot14(d,
e),e+=2,g.m.c=c.readF2dot14(d,e),e+=2,g.m.d=c.readF2dot14(d,e),e+=2);while(32&a);if(256&a)for(c=c.readUshort(d,e),e+=2,b.instr=[],a=0;a<c;a++)b.instr.push(d[e]),e++}return b};f.GPOS={};f.GPOS.parse=function(b,a,c,d){return f._lctf.parse(b,a,c,d,f.GPOS.subt)};f.GPOS.subt=function(b,a,c,d){var e=f._bin,g=c,h={};if(h.fmt=e.readUshort(b,c),c+=2,1==a||2==a||3==a||7==a||8==a&&2>=h.fmt){var k=e.readUshort(b,c);c+=2;h.coverage=f._lctf.readCoverage(b,k+g)}if(1==a&&1==h.fmt)d=e.readUshort(b,c),c+=2,f._lctf.numOfOnes(d),
0!=d&&(h.pos=f.GPOS.readValueRecord(b,c,d));else if(2==a&&1<=h.fmt&&2>=h.fmt){d=e.readUshort(b,c);c+=2;k=e.readUshort(b,c);c+=2;a=f._lctf.numOfOnes(d);var q=f._lctf.numOfOnes(k);if(1==h.fmt){h.pairsets=[];var l=e.readUshort(b,c);c+=2;for(var m=0;m<l;m++){var p=g+e.readUshort(b,c);c+=2;var n=e.readUshort(b,p);p+=2;for(var r=[],t=0;t<n;t++){var y=e.readUshort(b,p);p+=2;0!=d&&(x=f.GPOS.readValueRecord(b,p,d),p+=2*a);0!=k&&(E=f.GPOS.readValueRecord(b,p,k),p+=2*q);r.push({gid2:y,val1:x,val2:E})}h.pairsets.push(r)}}if(2==
h.fmt)for(x=e.readUshort(b,c),c+=2,E=e.readUshort(b,c),c+=2,l=e.readUshort(b,c),c+=2,e=e.readUshort(b,c),c+=2,h.classDef1=f._lctf.readClassDef(b,g+x),h.classDef2=f._lctf.readClassDef(b,g+E),h.matrix=[],m=0;m<l;m++){g=[];for(t=0;t<e;t++){var x=null,E=null;0!=d&&(x=f.GPOS.readValueRecord(b,c,d),c+=2*a);0!=k&&(E=f.GPOS.readValueRecord(b,c,k),c+=2*q);g.push({val1:x,val2:E})}h.matrix.push(g)}}else{if(9==a&&1==h.fmt){h=e.readUshort(b,c);c=e.readUint(b,c+2);if(9==d.ltype)d.ltype=h;else if(d.ltype!=h)throw"invalid extension substitution";
return f.GPOS.subt(b,d.ltype,g+c)}console.debug("unsupported GPOS table LookupType",a,"format",h.fmt)}return h};f.GPOS.readValueRecord=function(b,a,c){var d=f._bin,e=[];return e.push(1&c?d.readShort(b,a):0),a+=1&c?2:0,e.push(2&c?d.readShort(b,a):0),a+=2&c?2:0,e.push(4&c?d.readShort(b,a):0),a+=4&c?2:0,e.push(8&c?d.readShort(b,a):0),e};f.GSUB={};f.GSUB.parse=function(b,a,c,d){return f._lctf.parse(b,a,c,d,f.GSUB.subt)};f.GSUB.subt=function(b,a,c,d){var e=f._bin,g=c,h={};if(h.fmt=e.readUshort(b,c),c+=
2,1!=a&&4!=a&&5!=a&&6!=a)return null;if(1==a||4==a||5==a&&2>=h.fmt||6==a&&2>=h.fmt){var k=e.readUshort(b,c);c+=2;h.coverage=f._lctf.readCoverage(b,g+k)}if(1==a&&1<=h.fmt&&2>=h.fmt)1==h.fmt?h.delta=e.readShort(b,c):2==h.fmt&&(a=e.readUshort(b,c),h.newg=e.readUshorts(b,c+2,a));else if(4==a)for(h.vals=[],a=e.readUshort(b,c),c+=2,d=0;d<a;d++)k=e.readUshort(b,c),c+=2,h.vals.push(f.GSUB.readLigatureSet(b,g+k));else if(5==a&&2==h.fmt){if(2==h.fmt)for(d=e.readUshort(b,c),c+=2,h.cDef=f._lctf.readClassDef(b,
g+d),h.scset=[],a=e.readUshort(b,c),c+=2,d=0;d<a;d++)k=e.readUshort(b,c),c+=2,h.scset.push(0==k?null:f.GSUB.readSubClassSet(b,g+k))}else if(6==a&&3==h.fmt){if(3==h.fmt){for(d=0;3>d;d++){a=e.readUshort(b,c);c+=2;k=[];for(var q=0;q<a;q++)k.push(f._lctf.readCoverage(b,g+e.readUshort(b,c+2*q)));c+=2*a;0==d&&(h.backCvg=k);1==d&&(h.inptCvg=k);2==d&&(h.ahedCvg=k)}a=e.readUshort(b,c);h.lookupRec=f.GSUB.readSubstLookupRecords(b,c+2,a)}}else{if(7==a&&1==h.fmt){h=e.readUshort(b,c);c=e.readUint(b,c+2);if(9==
d.ltype)d.ltype=h;else if(d.ltype!=h)throw"invalid extension substitution";return f.GSUB.subt(b,d.ltype,g+c)}console.debug("unsupported GSUB table LookupType",a,"format",h.fmt)}return h};f.GSUB.readSubClassSet=function(b,a){var c=f._bin.readUshort,d=a,e=[],g=c(b,a);a+=2;for(var h=0;h<g;h++){var k=c(b,a);a+=2;e.push(f.GSUB.readSubClassRule(b,d+k))}return e};f.GSUB.readSubClassRule=function(b,a){var c=f._bin.readUshort,d={},e=c(b,a),g=c(b,a+=2);a+=2;d.input=[];for(var h=0;h<e-1;h++)d.input.push(c(b,
a)),a+=2;return d.substLookupRecords=f.GSUB.readSubstLookupRecords(b,a,g),d};f.GSUB.readSubstLookupRecords=function(b,a,c){for(var d=f._bin.readUshort,e=[],g=0;g<c;g++)e.push(d(b,a),d(b,a+2)),a+=4;return e};f.GSUB.readChainSubClassSet=function(b,a){var c=f._bin,d=a,e=[],g=c.readUshort(b,a);a+=2;for(var h=0;h<g;h++){var k=c.readUshort(b,a);a+=2;e.push(f.GSUB.readChainSubClassRule(b,d+k))}return e};f.GSUB.readChainSubClassRule=function(b,a){for(var c=f._bin,d={},e=["backtrack","input","lookahead"],
g=0;g<e.length;g++){var h=c.readUshort(b,a);a+=2;1==g&&h--;d[e[g]]=c.readUshorts(b,a,h);a+=2*d[e[g]].length}h=c.readUshort(b,a);return a+=2,d.subst=c.readUshorts(b,a,2*h),d};f.GSUB.readLigatureSet=function(b,a){var c=f._bin,d=a,e=[],g=c.readUshort(b,a);a+=2;for(var h=0;h<g;h++){var k=c.readUshort(b,a);a+=2;e.push(f.GSUB.readLigature(b,d+k))}return e};f.GSUB.readLigature=function(b,a){var c=f._bin,d={chain:[]};d.nglyph=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;for(var g=0;g<e-1;g++)d.chain.push(c.readUshort(b,
a)),a+=2;return d};f.head={};f.head.parse=function(b,a,c){c=f._bin;var d={};return c.readFixed(b,a),a+=4,d.fontRevision=c.readFixed(b,a),a+=4,c.readUint(b,a),a+=4,c.readUint(b,a),a+=4,d.flags=c.readUshort(b,a),a+=2,d.unitsPerEm=c.readUshort(b,a),a+=2,d.created=c.readUint64(b,a),a+=8,d.modified=c.readUint64(b,a),a+=8,d.xMin=c.readShort(b,a),a+=2,d.yMin=c.readShort(b,a),a+=2,d.xMax=c.readShort(b,a),a+=2,d.yMax=c.readShort(b,a),a+=2,d.macStyle=c.readUshort(b,a),a+=2,d.lowestRecPPEM=c.readUshort(b,a),
a+=2,d.fontDirectionHint=c.readShort(b,a),a+=2,d.indexToLocFormat=c.readShort(b,a),a+=2,d.glyphDataFormat=c.readShort(b,a),d};f.hhea={};f.hhea.parse=function(b,a,c){c=f._bin;var d={};return c.readFixed(b,a),a+=4,d.ascender=c.readShort(b,a),a+=2,d.descender=c.readShort(b,a),a+=2,d.lineGap=c.readShort(b,a),a+=2,d.advanceWidthMax=c.readUshort(b,a),a+=2,d.minLeftSideBearing=c.readShort(b,a),a+=2,d.minRightSideBearing=c.readShort(b,a),a+=2,d.xMaxExtent=c.readShort(b,a),a+=2,d.caretSlopeRise=c.readShort(b,
a),a+=2,d.caretSlopeRun=c.readShort(b,a),a+=2,d.caretOffset=c.readShort(b,a),a+=2,a+=8,d.metricDataFormat=c.readShort(b,a),a+=2,d.numberOfHMetrics=c.readUshort(b,a),d};f.hmtx={};f.hmtx.parse=function(b,a,c,d){c=f._bin;for(var e={aWidth:[],lsBearing:[]},g=0,h=0,k=0;k<d.maxp.numGlyphs;k++)k<d.hhea.numberOfHMetrics&&(g=c.readUshort(b,a),a+=2,h=c.readShort(b,a),a+=2),e.aWidth.push(g),e.lsBearing.push(h);return e};f.kern={};f.kern.parse=function(b,a,c,d){var e=f._bin,g=e.readUshort(b,a);if(a+=2,1==g)return f.kern.parseV1(b,
a-2,c,d);c=e.readUshort(b,a);a+=2;d={glyph1:[],rval:[]};for(g=0;g<c;g++){a+=2;e.readUshort(b,a);a+=2;var h=e.readUshort(b,a);a+=2;h>>>=8;if(0!=(h&=15))throw"unknown kern table format: "+h;a=f.kern.readFormat0(b,a,d)}return d};f.kern.parseV1=function(b,a,c,d){c=f._bin;c.readFixed(b,a);a+=4;d=c.readUint(b,a);a+=4;for(var e={glyph1:[],rval:[]},g=0;g<d;g++){c.readUint(b,a);a+=4;var h=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;h>>>=8;if(0!=(h&=15))throw"unknown kern table format: "+h;a=f.kern.readFormat0(b,
a,e)}return e};f.kern.readFormat0=function(b,a,c){var d=f._bin,e=-1,g=d.readUshort(b,a);a+=2;d.readUshort(b,a);a+=2;d.readUshort(b,a);a+=2;d.readUshort(b,a);a+=2;for(var h=0;h<g;h++){var k=d.readUshort(b,a);a+=2;var q=d.readUshort(b,a);a+=2;var l=d.readShort(b,a);a+=2;k!=e&&(c.glyph1.push(k),c.rval.push({glyph2:[],vals:[]}));e=c.rval[c.rval.length-1];e.glyph2.push(q);e.vals.push(l);e=k}return a};f.loca={};f.loca.parse=function(b,a,c,d){c=f._bin;var e=[],g=d.head.indexToLocFormat;d=d.maxp.numGlyphs+
1;if(0==g)for(var h=0;h<d;h++)e.push(c.readUshort(b,a+(h<<1))<<1);if(1==g)for(h=0;h<d;h++)e.push(c.readUint(b,a+(h<<2)));return e};f.maxp={};f.maxp.parse=function(b,a,c){c=f._bin;var d={},e=c.readUint(b,a);return a+=4,d.numGlyphs=c.readUshort(b,a),a+=2,65536==e&&(d.maxPoints=c.readUshort(b,a),a+=2,d.maxContours=c.readUshort(b,a),a+=2,d.maxCompositePoints=c.readUshort(b,a),a+=2,d.maxCompositeContours=c.readUshort(b,a),a+=2,d.maxZones=c.readUshort(b,a),a+=2,d.maxTwilightPoints=c.readUshort(b,a),a+=
2,d.maxStorage=c.readUshort(b,a),a+=2,d.maxFunctionDefs=c.readUshort(b,a),a+=2,d.maxInstructionDefs=c.readUshort(b,a),a+=2,d.maxStackElements=c.readUshort(b,a),a+=2,d.maxSizeOfInstructions=c.readUshort(b,a),a+=2,d.maxComponentElements=c.readUshort(b,a),a+=2,d.maxComponentDepth=c.readUshort(b,a)),d};f.name={};f.name.parse=function(b,a,c){c=f._bin;var d={};c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;c.readUshort(b,a);for(var g,h="copyright fontFamily fontSubfamily ID fullName version postScriptName trademark manufacturer designer description urlVendor urlDesigner licence licenceURL --- typoFamilyName typoSubfamilyName compatibleFull sampleText postScriptCID wwsFamilyName wwsSubfamilyName lightPalette darkPalette".split(" "),
k=a+=2,q=0;q<e;q++){var l=c.readUshort(b,a);a+=2;var m=c.readUshort(b,a);a+=2;var p=c.readUshort(b,a);a+=2;var n=c.readUshort(b,a);a+=2;var r=c.readUshort(b,a);a+=2;var t=c.readUshort(b,a);a+=2;var y=h[n];t=k+12*e+t;if(0==l)r=c.readUnicode(b,t,r/2);else if(3==l&&0==m)r=c.readUnicode(b,t,r/2);else if(0==m)r=c.readASCII(b,t,r);else if(1==m)r=c.readUnicode(b,t,r/2);else if(3==m)r=c.readUnicode(b,t,r/2);else{if(1!=l)throw"unknown encoding "+m+", platformID: "+l;r=c.readASCII(b,t,r);console.debug("reading unknown MAC encoding "+
m+" as ASCII")}l="p"+l+","+p.toString(16);null==d[l]&&(d[l]={});d[l][void 0!==y?y:n]=r;d[l]._lang=p}for(var x in d)if(null!=d[x].postScriptName&&1033==d[x]._lang)return d[x];for(x in d)if(null!=d[x].postScriptName&&0==d[x]._lang)return d[x];for(x in d)if(null!=d[x].postScriptName&&3084==d[x]._lang)return d[x];for(x in d)if(null!=d[x].postScriptName)return d[x];for(x in d){g=x;break}return console.debug("returning name table with languageID "+d[g]._lang),d[g]};f["OS/2"]={};f["OS/2"].parse=function(b,
a,c){c=f._bin.readUshort(b,a);a+=2;var d={};if(0==c)f["OS/2"].version0(b,a,d);else if(1==c)f["OS/2"].version1(b,a,d);else if(2==c||3==c||4==c)f["OS/2"].version2(b,a,d);else{if(5!=c)throw"unknown OS/2 table version: "+c;f["OS/2"].version5(b,a,d)}return d};f["OS/2"].version0=function(b,a,c){var d=f._bin;return c.xAvgCharWidth=d.readShort(b,a),a+=2,c.usWeightClass=d.readUshort(b,a),a+=2,c.usWidthClass=d.readUshort(b,a),a+=2,c.fsType=d.readUshort(b,a),a+=2,c.ySubscriptXSize=d.readShort(b,a),a+=2,c.ySubscriptYSize=
d.readShort(b,a),a+=2,c.ySubscriptXOffset=d.readShort(b,a),a+=2,c.ySubscriptYOffset=d.readShort(b,a),a+=2,c.ySuperscriptXSize=d.readShort(b,a),a+=2,c.ySuperscriptYSize=d.readShort(b,a),a+=2,c.ySuperscriptXOffset=d.readShort(b,a),a+=2,c.ySuperscriptYOffset=d.readShort(b,a),a+=2,c.yStrikeoutSize=d.readShort(b,a),a+=2,c.yStrikeoutPosition=d.readShort(b,a),a+=2,c.sFamilyClass=d.readShort(b,a),a+=2,c.panose=d.readBytes(b,a,10),a+=10,c.ulUnicodeRange1=d.readUint(b,a),a+=4,c.ulUnicodeRange2=d.readUint(b,
a),a+=4,c.ulUnicodeRange3=d.readUint(b,a),a+=4,c.ulUnicodeRange4=d.readUint(b,a),a+=4,c.achVendID=[d.readInt8(b,a),d.readInt8(b,a+1),d.readInt8(b,a+2),d.readInt8(b,a+3)],a+=4,c.fsSelection=d.readUshort(b,a),a+=2,c.usFirstCharIndex=d.readUshort(b,a),a+=2,c.usLastCharIndex=d.readUshort(b,a),a+=2,c.sTypoAscender=d.readShort(b,a),a+=2,c.sTypoDescender=d.readShort(b,a),a+=2,c.sTypoLineGap=d.readShort(b,a),a+=2,c.usWinAscent=d.readUshort(b,a),a+=2,c.usWinDescent=d.readUshort(b,a),a+2};f["OS/2"].version1=
function(b,a,c){var d=f._bin;return a=f["OS/2"].version0(b,a,c),c.ulCodePageRange1=d.readUint(b,a),a+=4,c.ulCodePageRange2=d.readUint(b,a),a+4};f["OS/2"].version2=function(b,a,c){var d=f._bin;return a=f["OS/2"].version1(b,a,c),c.sxHeight=d.readShort(b,a),a+=2,c.sCapHeight=d.readShort(b,a),a+=2,c.usDefault=d.readUshort(b,a),a+=2,c.usBreak=d.readUshort(b,a),a+=2,c.usMaxContext=d.readUshort(b,a),a+2};f["OS/2"].version5=function(b,a,c){var d=f._bin;return a=f["OS/2"].version2(b,a,c),c.usLowerOpticalPointSize=
d.readUshort(b,a),a+=2,c.usUpperOpticalPointSize=d.readUshort(b,a),a+2};f.post={};f.post.parse=function(b,a,c){c=f._bin;var d={};return d.version=c.readFixed(b,a),a+=4,d.italicAngle=c.readFixed(b,a),a+=4,d.underlinePosition=c.readShort(b,a),a+=2,d.underlineThickness=c.readShort(b,a),d};null==f&&(f={});null==f.U&&(f.U={});f.U.codeToGlyph=function(b,a){b=b.cmap;var c=-1;if(null!=b.p0e4?c=b.p0e4:null!=b.p3e1?c=b.p3e1:null!=b.p1e0?c=b.p1e0:null!=b.p0e3&&(c=b.p0e3),-1==c)throw"no familiar platform and encoding!";
b=b.tables[c];if(0==b.format)return a>=b.map.length?0:b.map[a];if(4==b.format){var d=-1;for(c=0;c<b.endCount.length;c++)if(a<=b.endCount[c]){d=c;break}return-1==d||b.startCount[d]>a?0:65535&(0!=b.idRangeOffset[d]?b.glyphIdArray[a-b.startCount[d]+(b.idRangeOffset[d]>>1)-(b.idRangeOffset.length-d)]:a+b.idDelta[d])}if(12==b.format){if(a>b.groups[b.groups.length-1][1])return 0;for(c=0;c<b.groups.length;c++)if(d=b.groups[c],d[0]<=a&&a<=d[1])return d[2]+(a-d[0]);return 0}throw"unknown cmap table format "+
b.format;};f.U.glyphToPath=function(b,a){var c={cmds:[],crds:[]};if(b.SVG&&b.SVG.entries[a]){var d=b.SVG.entries[a];return null==d?c:("string"==typeof d&&(d=f.SVG.toPath(d),b.SVG.entries[a]=d),d)}if(b.CFF){d={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:b.CFF.Private?b.CFF.Private.defaultWidthX:0,open:!1};var e=b.CFF,g=b.CFF.Private;if(e.ROS){for(g=0;e.FDSelect[g+2]<=a;)g+=2;g=e.FDArray[e.FDSelect[g+1]].Private}f.U._drawCFF(b.CFF.CharStrings[a],d,e,g,c)}else b.glyf&&f.U._drawGlyf(a,b,c);return c};
f.U._drawGlyf=function(b,a,c){var d=a.glyf[b];null==d&&(d=a.glyf[b]=f.glyf._parseGlyf(a,b));null!=d&&(-1<d.noc?f.U._simpleGlyph(d,c):f.U._compoGlyph(d,a,c))};f.U._simpleGlyph=function(b,a){for(var c=0;c<b.noc;c++){for(var d=0==c?0:b.endPts[c-1]+1,e=b.endPts[c],g=d;g<=e;g++){var h=g==d?e:g-1,k=g==e?d:g+1,q=1&b.flags[g],l=1&b.flags[h],m=1&b.flags[k],p=b.xs[g],n=b.ys[g];if(g==d)if(q){if(!l){f.U.P.moveTo(a,p,n);continue}f.U.P.moveTo(a,b.xs[h],b.ys[h])}else l?f.U.P.moveTo(a,b.xs[h],b.ys[h]):f.U.P.moveTo(a,
(b.xs[h]+p)/2,(b.ys[h]+n)/2);q?l&&f.U.P.lineTo(a,p,n):m?f.U.P.qcurveTo(a,p,n,b.xs[k],b.ys[k]):f.U.P.qcurveTo(a,p,n,(p+b.xs[k])/2,(n+b.ys[k])/2)}f.U.P.closePath(a)}};f.U._compoGlyph=function(b,a,c){for(var d=0;d<b.parts.length;d++){var e={cmds:[],crds:[]},g=b.parts[d];f.U._drawGlyf(g.glyphIndex,a,e);g=g.m;for(var h=0;h<e.crds.length;h+=2){var k=e.crds[h],l=e.crds[h+1];c.crds.push(k*g.a+l*g.b+g.tx);c.crds.push(k*g.c+l*g.d+g.ty)}for(h=0;h<e.cmds.length;h++)c.cmds.push(e.cmds[h])}};f.U._getGlyphClass=
function(b,a){b=f._lctf.getInterval(a,b);return-1==b?0:a[b+2]};f.U.getPairAdjustment=function(b,a,c){var d=0;if(b.GPOS){var e=b.GPOS,g=e.lookupList;e=e.featureList;for(var h=[],k=0;k<e.length;k++){var l=e[k];if("kern"==l.tag)for(var m=0;m<l.tab.length;m++)if(!h[l.tab[m]]){h[l.tab[m]]=!0;for(var u=g[l.tab[m]],p=0;p<u.tabs.length;p++)if(null!=u.tabs[p]){var n,r=u.tabs[p];if((!r.coverage||-1!=(n=f._lctf.coverageIndex(r.coverage,a)))&&1!=u.ltype&&2==u.ltype){var t;if(1==r.fmt)for(r=r.pairsets[n],k=0;k<
r.length;k++)r[k].gid2==c&&(t=r[k]);else if(2==r.fmt){t=f.U._getGlyphClass(a,r.classDef1);var y=f.U._getGlyphClass(c,r.classDef2);t=r.matrix[t][y]}t&&t.val1&&t.val1[2]&&(d+=t.val1[2]);t&&t.val2&&t.val2[0]&&(d+=t.val2[0])}}}}}b.kern&&(a=b.kern.glyph1.indexOf(a),-1!=a&&(c=b.kern.rval[a].glyph2.indexOf(c),-1!=c&&(d+=b.kern.rval[a].vals[c])));return d};f.U._applySubs=function(b,a,c,d){for(var e=b.length-a-1,g=0;g<c.tabs.length;g++)if(null!=c.tabs[g]){var h,k=c.tabs[g];if(!k.coverage||-1!=(h=f._lctf.coverageIndex(k.coverage,
b[a])))if(1==c.ltype)b[a],1==k.fmt?b[a]+=k.delta:b[a]=k.newg[h];else if(4==c.ltype)for(var l=k.vals[h],m=0;m<l.length;m++){var u=l[m];k=u.chain.length;if(!(k>e)){for(var p=!0,n=0,r=0;r<k;r++){for(;-1==b[a+n+(1+r)];)n++;u.chain[r]!=b[a+n+(1+r)]&&(p=!1)}if(p){b[a]=u.nglyph;for(r=0;r<k+n;r++)b[a+r+1]=-1;break}}}else if(5==c.ltype&&2==k.fmt)for(l=f._lctf.getInterval(k.cDef,b[a]),n=k.scset[k.cDef[l+2]],u=0;u<n.length;u++){m=n[u];var t=m.input;if(!(t.length>e)){p=!0;for(r=0;r<t.length;r++){var y=f._lctf.getInterval(k.cDef,
b[a+1+r]);if(-1==l&&k.cDef[y+2]!=t[r]){p=!1;break}}if(p)for(p=m.substLookupRecords,m=0;m<p.length;m+=2)p[m],p[m+1]}}else if(6==c.ltype&&3==k.fmt&&f.U._glsCovered(b,k.backCvg,a-k.backCvg.length)&&f.U._glsCovered(b,k.inptCvg,a)&&f.U._glsCovered(b,k.ahedCvg,a+k.inptCvg.length))for(p=k.lookupRec,u=0;u<p.length;u+=2)l=p[u],f.U._applySubs(b,a+l,d[p[u+1]],d)}};f.U._glsCovered=function(b,a,c){for(var d=0;d<a.length;d++)if(-1==f._lctf.coverageIndex(a[d],b[c+d]))return!1;return!0};f.U.glyphsToPath=function(b,
a,c){for(var d={cmds:[],crds:[]},e=0,g=0;g<a.length;g++){var h=a[g];if(-1!=h){for(var k=g<a.length-1&&-1!=a[g+1]?a[g+1]:0,l=f.U.glyphToPath(b,h),m=0;m<l.crds.length;m+=2)d.crds.push(l.crds[m]+e),d.crds.push(l.crds[m+1]);c&&d.cmds.push(c);for(m=0;m<l.cmds.length;m++)d.cmds.push(l.cmds[m]);c&&d.cmds.push("X");e+=b.hmtx.aWidth[h];g<a.length-1&&(e+=f.U.getPairAdjustment(b,h,k))}}return d};f.U.P={};f.U.P.moveTo=function(b,a,c){b.cmds.push("M");b.crds.push(a,c)};f.U.P.lineTo=function(b,a,c){b.cmds.push("L");
b.crds.push(a,c)};f.U.P.curveTo=function(b,a,c,d,e,g,f){b.cmds.push("C");b.crds.push(a,c,d,e,g,f)};f.U.P.qcurveTo=function(b,a,c,d,e){b.cmds.push("Q");b.crds.push(a,c,d,e)};f.U.P.closePath=function(b){b.cmds.push("Z")};f.U._drawCFF=function(b,a,c,d,e){for(var g=a.stack,h=a.nStems,k=a.haveWidth,l=a.width,m=a.open,u=0,p=a.x,n=a.y,r=0,t=0,y=0,x=0,E=0,D=0,I=0,N=0,O=0,J=0,ia={val:0,size:0};u<b.length;){f.CFF.getCharString(b,u,ia);var v=ia.val;if(u+=ia.size,"o1"==v||"o18"==v)0!=g.length%2&&!k&&(l=g.shift()+
d.nominalWidthX),h+=g.length>>1,g.length=0,k=!0;else if("o3"==v||"o23"==v)0!=g.length%2&&!k&&(l=g.shift()+d.nominalWidthX),h+=g.length>>1,g.length=0,k=!0;else if("o4"==v)1<g.length&&!k&&(l=g.shift()+d.nominalWidthX,k=!0),m&&f.U.P.closePath(e),n+=g.pop(),f.U.P.moveTo(e,p,n),m=!0;else if("o5"==v)for(;0<g.length;)p+=g.shift(),n+=g.shift(),f.U.P.lineTo(e,p,n);else if("o6"==v||"o7"==v){var w=g.length,A="o6"==v;for(v=0;v<w;v++){var G=g.shift();A?p+=G:n+=G;A=!A;f.U.P.lineTo(e,p,n)}}else if("o8"==v||"o24"==
v){w=g.length;for(A=0;A+6<=w;)r=p+g.shift(),t=n+g.shift(),y=r+g.shift(),x=t+g.shift(),p=y+g.shift(),n=x+g.shift(),f.U.P.curveTo(e,r,t,y,x,p,n),A+=6;"o24"==v&&(p+=g.shift(),n+=g.shift(),f.U.P.lineTo(e,p,n))}else{if("o11"==v)break;if("o1234"==v||"o1235"==v||"o1236"==v||"o1237"==v)"o1234"==v&&(t=n,y=(r=p+g.shift())+g.shift(),J=x=t+g.shift(),D=x,N=n,p=(I=(E=(O=y+g.shift())+g.shift())+g.shift())+g.shift(),f.U.P.curveTo(e,r,t,y,x,O,J),f.U.P.curveTo(e,E,D,I,N,p,n)),"o1235"==v&&(r=p+g.shift(),t=n+g.shift(),
y=r+g.shift(),x=t+g.shift(),O=y+g.shift(),J=x+g.shift(),E=O+g.shift(),D=J+g.shift(),I=E+g.shift(),N=D+g.shift(),p=I+g.shift(),n=N+g.shift(),g.shift(),f.U.P.curveTo(e,r,t,y,x,O,J),f.U.P.curveTo(e,E,D,I,N,p,n)),"o1236"==v&&(r=p+g.shift(),t=n+g.shift(),y=r+g.shift(),J=x=t+g.shift(),D=x,I=(E=(O=y+g.shift())+g.shift())+g.shift(),N=D+g.shift(),p=I+g.shift(),f.U.P.curveTo(e,r,t,y,x,O,J),f.U.P.curveTo(e,E,D,I,N,p,n)),"o1237"==v&&(r=p+g.shift(),t=n+g.shift(),y=r+g.shift(),x=t+g.shift(),O=y+g.shift(),J=x+g.shift(),
E=O+g.shift(),D=J+g.shift(),I=E+g.shift(),N=D+g.shift(),Math.abs(I-p)>Math.abs(N-n)?p=I+g.shift():n=N+g.shift(),f.U.P.curveTo(e,r,t,y,x,O,J),f.U.P.curveTo(e,E,D,I,N,p,n));else if("o14"==v){if(0<g.length&&!k&&(l=g.shift()+c.nominalWidthX,k=!0),4==g.length)w=g.shift(),A=g.shift(),G=g.shift(),v=g.shift(),G=f.CFF.glyphBySE(c,G),v=f.CFF.glyphBySE(c,v),f.U._drawCFF(c.CharStrings[G],a,c,d,e),a.x=w,a.y=A,f.U._drawCFF(c.CharStrings[v],a,c,d,e);m&&(f.U.P.closePath(e),m=!1)}else if("o19"==v||"o20"==v)0!=g.length%
2&&!k&&(l=g.shift()+d.nominalWidthX),h+=g.length>>1,g.length=0,k=!0,u+=h+7>>3;else if("o21"==v)2<g.length&&!k&&(l=g.shift()+d.nominalWidthX,k=!0),n+=g.pop(),p+=g.pop(),m&&f.U.P.closePath(e),f.U.P.moveTo(e,p,n),m=!0;else if("o22"==v)1<g.length&&!k&&(l=g.shift()+d.nominalWidthX,k=!0),p+=g.pop(),m&&f.U.P.closePath(e),f.U.P.moveTo(e,p,n),m=!0;else if("o25"==v){for(;6<g.length;)p+=g.shift(),n+=g.shift(),f.U.P.lineTo(e,p,n);r=p+g.shift();t=n+g.shift();y=r+g.shift();x=t+g.shift();p=y+g.shift();n=x+g.shift();
f.U.P.curveTo(e,r,t,y,x,p,n)}else if("o26"==v)for(g.length%2&&(p+=g.shift());0<g.length;)r=p,t=n+g.shift(),p=y=r+g.shift(),n=(x=t+g.shift())+g.shift(),f.U.P.curveTo(e,r,t,y,x,p,n);else if("o27"==v)for(g.length%2&&(n+=g.shift());0<g.length;)t=n,y=(r=p+g.shift())+g.shift(),x=t+g.shift(),p=y+g.shift(),n=x,f.U.P.curveTo(e,r,t,y,x,p,n);else if("o10"==v||"o29"==v)w="o10"==v?d:c,0==g.length?console.debug("error: empty stack"):(A=g.pop(),w=w.Subrs[A+w.Bias],a.x=p,a.y=n,a.nStems=h,a.haveWidth=k,a.width=l,
a.open=m,f.U._drawCFF(w,a,c,d,e),p=a.x,n=a.y,h=a.nStems,k=a.haveWidth,l=a.width,m=a.open);else if("o30"==v||"o31"==v)for(w=g.length,v=(A=0,"o31"==v),A+=w-(w&=-3);A<w;)v?(t=n,y=(r=p+g.shift())+g.shift(),n=(x=t+g.shift())+g.shift(),5==w-A?(p=y+g.shift(),A++):p=y,v=!1):(r=p,t=n+g.shift(),y=r+g.shift(),x=t+g.shift(),p=y+g.shift(),5==w-A?(n=x+g.shift(),A++):n=x,v=!0),f.U.P.curveTo(e,r,t,y,x,p,n),A+=4;else{if("o"==(v+"").charAt(0))throw console.debug("Unknown operation: "+v,b),v;g.push(v)}}}a.x=p;a.y=n;
a.nStems=h;a.haveWidth=k;a.width=l;a.open=m};var u=f,m={Typr:u};return l.Typr=u,l.default=m,Object.defineProperty(l,"__esModule",{value:!0}),l}({}).Typr},function(){return function(l){var f=Uint8Array,u=Uint16Array,m=Uint32Array,b=new f([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),a=new f([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),c=new f([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),d=function(a,b){for(var c=new u(31),d=0;31>d;++d)c[d]=b+=
1<<a[d-1];a=new m(c[30]);for(d=1;30>d;++d)for(b=c[d];b<c[d+1];++b)a[b]=b-c[d]<<5|d;return[c,a]},e=d(b,2),g=e[0];e=e[1];g[28]=258;e[258]=28;var h=d(a,0)[0],k=new u(32768);for(d=0;32768>d;++d)e=(43690&d)>>>1|(21845&d)<<1,e=(61680&(e=(52428&e)>>>2|(13107&e)<<2))>>>4|(3855&e)<<4,k[d]=((65280&e)>>>8|(255&e)<<8)>>>1;var q=function(a,b,c){for(var d=a.length,e=0,g=new u(b);e<d;++e)++g[a[e]-1];var f=new u(b);for(e=0;e<b;++e)f[e]=f[e-1]+g[e-1]<<1;if(c)for(c=new u(1<<b),g=15-b,e=0;e<d;++e){if(a[e]){var h=e<<
4|a[e],l=b-a[e],t=f[a[e]-1]++<<l;for(l=t|(1<<l)-1;t<=l;++t)c[k[t]>>>g]=h}}else for(c=new u(d),e=0;e<d;++e)c[e]=k[f[a[e]-1]++]>>>15-a[e];return c};e=new f(288);for(d=0;144>d;++d)e[d]=8;for(d=144;256>d;++d)e[d]=9;for(d=256;280>d;++d)e[d]=7;for(d=280;288>d;++d)e[d]=8;var z=new f(32);for(d=0;32>d;++d)z[d]=5;var B=q(e,9,1),p=q(z,5,1),n=function(a){for(var b=a[0],c=1;c<a.length;++c)a[c]>b&&(b=a[c]);return b},r=function(a,b,c){var d=b/8>>0;return(a[d]|a[d+1]<<8)>>>(7&b)&c},t=function(a,b){var c=b/8>>0;return(a[c]|
a[c+1]<<8|a[c+2]<<16)>>>(7&b)},y=function(d,e,k){var l=d.length,x=!e||k,y=!k||k.i;k||(k={});e||(e=new f(3*l));var E,D=function(a){var b=e.length;a>b&&(a=new f(Math.max(2*b,a)),a.set(e),e=a)},v=k.f||0,w=k.p||0,A=k.b||0,G=k.l,z=k.d,P=k.m,L=k.n,F=8*l;do{if(!G){k.f=v=r(d,w,1);var C=r(d,w+1,3);if(w+=3,!C){w=d[(U=((E=w)/8>>0)+(7&E&&1)+4)-4]|d[U-3]<<8;C=U+w;if(C>l){if(y)throw"unexpected EOF";break}x&&D(A+w);e.set(d.subarray(U,C),A);k.b=A+=w;k.p=w=8*C;continue}if(1==C)G=B,z=p,P=9,L=5;else{if(2!=C)throw"invalid block type";
P=r(d,w,31)+257;z=r(d,w+10,15)+4;G=P+r(d,w+5,31)+1;w+=14;L=new f(G);var H=new f(19);for(C=0;C<z;++C)H[c[C]]=r(d,w+3*C,7);w+=3*z;C=n(H);z=(1<<C)-1;if(!y&&w+G*(C+7)>F)break;var V=q(H,C,1);for(C=0;C<G;){var U;U=V[r(d,w,z)];if(w+=15&U,16>(U>>>=4))L[C++]=U;else{var ba=H=0;for(16==U?(ba=3+r(d,w,3),w+=2,H=L[C-1]):17==U?(ba=3+r(d,w,7),w+=3):18==U&&(ba=11+r(d,w,127),w+=7);ba--;)L[C++]=H}}G=L.subarray(0,P);C=L.subarray(P);P=n(G);L=n(C);G=q(G,P,1);z=q(C,L,1)}if(w>F)throw"unexpected EOF";}x&&D(A+131072);V=(1<<
P)-1;ba=(1<<L)-1;for(var ya=P+L+18;y||w+ya<F;){C=(H=G[t(d,w)&V])>>>4;if((w+=15&H)>F)throw"unexpected EOF";if(!H)throw"invalid length/literal";if(256>C)e[A++]=C;else{if(256==C){G=null;break}H=C-254;if(264<C){var W=b[C-=257];H=r(d,w,(1<<W)-1)+g[C];w+=W}C=z[t(d,w)&ba];W=C>>>4;if(!C)throw"invalid distance";w+=15&C;C=h[W];3<W&&(W=a[W],C+=t(d,w)&(1<<W)-1,w+=W);if(w>F)throw"unexpected EOF";x&&D(A+131072);for(H=A+H;A<H;A+=4)e[A]=e[A-C],e[A+1]=e[A+1-C],e[A+2]=e[A+2-C],e[A+3]=e[A+3-C];A=H}}k.l=G;k.p=w;k.b=
A;G&&(v=1,k.m=P,k.d=z,k.n=L)}while(!v);return A==e.length?e:function(a,b,c){(null==b||0>b)&&(b=0);(null==c||c>a.length)&&(c=a.length);var d=new (a instanceof u?u:a instanceof m?m:f)(c-b);return d.set(a.subarray(b,c)),d}(e,0,A)};return l.convert_streams=function(a){function b(){var a=g.getUint16(f);return f+=2,a}function c(){var a=g.getUint32(f);return f+=4,a}function d(a){u.setUint16(z,a);z+=2}function e(a){u.setUint32(z,a);z+=4}var g=new DataView(a),f=0;c();var h=c();c();var k=b();b();c();b();b();
c();c();c();c();c();for(var l=0;Math.pow(2,l)<=k;)l++;l--;for(var t=16*Math.pow(2,l),n=16*k-t,p=12,x=[],r=0;r<k;r++)x.push({tag:c(),offset:c(),compLength:c(),origLength:c(),origChecksum:c()}),p+=16;var m,q=new Uint8Array(12+16*x.length+x.reduce(function(a,b){return a+b.origLength+4},0));r=q.buffer;var u=new DataView(r),z=0;return e(h),d(k),d(t),d(l),d(n),x.forEach(function(a){e(a.tag);e(a.origChecksum);e(p);e(a.origLength);a.outOffset=p;0!=(p+=a.origLength)%4&&(p+=4-p%4)}),x.forEach(function(b){var c=
a.slice(b.offset,b.offset+b.compLength);if(b.compLength!=b.origLength){var d=new Uint8Array(b.origLength);c=new Uint8Array(c,2);y(c,d)}else d=new Uint8Array(c);q.set(d,b.outOffset);d=0;0!=(p=b.outOffset+b.origLength)%4&&(d=4-p%4);q.set((new Uint8Array(d)).buffer,b.outOffset+b.origLength);m=p+d}),r.slice(0,m)},l}({}).convert_streams},function(l,f){function u(a){if(!d){var b={R:2,L:1,D:4,C:16,U:32,T:8};d=new Map;var e=function(a){var e=0;c[a].split(",").forEach(function(c){var g=c.split("+");c=g[0];
g=g[1];c=parseInt(c,36);g=g?parseInt(g,36):0;d.set(e+=c,b[a]);for(c=g;c--;)d.set(++e,b[a])})},g;for(g in c)e(g)}return d.get(a)||32}function m(a,b){for(var c=[],d=0;d<b.length;d++){var g=b.codePointAt(d);65535<g&&d++;c.push(l.U.codeToGlyph(a,g))}if(a=a.GSUB){var f=a.lookupList,h,n=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws)$/,r=[];a.featureList.forEach(function(a){if(n.test(a.tag))for(var d=0;d<a.tab.length;d++)if(!r[a.tab[d]]){r[a.tab[d]]=!0;var g=f[a.tab[d]],k=/^(isol|init|fina|medi)$/.test(a.tag);
if(k&&!h){for(var t=b,p=new Uint8Array(t.length),m=32,q=1,z=-1,B=0;B<t.length;B++){var v=t.codePointAt(B),w=u(v)|0,A=1;w&8||(m&21?w&22?(A=3,1!==q&&3!==q||p[z]++):w&33&&(2===q||4===q)&&p[z]--:m&34&&(2===q||4===q)&&p[z]--,q=p[B]=A,m=w,z=B,65535<v&&B++)}h=p}for(t=0;t<c.length;t++)h&&k&&e[h[t]]!==a.tag||l.U._applySubs(c,t,g,f)}})}return c}function b(b){var c=Object.create(null),d={unitsPerEm:b.head.unitsPerEm,ascender:b.hhea.ascender,descender:b.hhea.descender,forEachGlyph:function(e,g,f,h){var k=0,p=
1/d.unitsPerEm*g,t=0,y=-1;m(b,e).forEach(function(d,n){if(-1!==d){n=c[d];if(!n){n=l.U.glyphToPath(b,d);var x=n.cmds,m=n.crds,r,q;if(m.length){n=r=Infinity;var u=q=-Infinity;for(var E=0,v=m.length;E<v;E+=2){var w=m[E],A=m[E+1];w<n&&(n=w);A<r&&(r=A);w>u&&(u=w);A>q&&(q=A)}}else n=u=r=q=0;n=c[d]={index:d,advanceWidth:b.hmtx.aWidth[d],xMin:n,yMin:r,xMax:u,yMax:q,pathCommandCount:x.length,forEachPathCommand:function(b){for(var c=0,d=[],e=0,g=x.length;e<g;e++){var f=a[x[e]];d.length=1+f;d[0]=x[e];for(var h=
1;h<=f;h++)d[h]=m[c++];b.apply(null,d)}}}}-1!==y&&(k+=l.U.getPairAdjustment(b,y,d)*p);h.call(null,n,k,t);n.advanceWidth&&(k+=n.advanceWidth*p);f&&(k+=f*g);y=d}t+=65535<e.codePointAt(t)?2:1});return k}};return d}var a={M:2,L:2,Q:4,C:6,Z:0},c={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",
R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},
d,e=[null,"isol","init","fina","medi"];return function(a){var c=new Uint8Array(a,0,4);c=l._bin.readASCII(c,0,4);if("wOFF"===c)a=f(a);else if("wOF2"===c)throw Error("woff2 fonts not supported");return b(l.parse(a)[0])}}],init:function(l,f,u){l=l();f=f();return u(l,f)}}),R={defaultFontURL:"https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxM.woff",sdfGlyphSize:64,sdfMargin:.0625,sdfExponent:9,textureWidth:2048},va=new B.Color,ha=!1,aa=Object.create(null),Y;K=Q.defineWorkerModule({name:"FontProcessor",
dependencies:[R,za,function(){function l(){f&&(u.sort(function(f,b){return f.maxX-b.maxX}),f=!1)}var f=!1,u=[];return{addLineSegment:function(l,b,a,c){u.push({x0:l,y0:b,x1:a,y1:c,minX:Math.min(l,a),minY:Math.min(b,c),maxX:Math.max(l,a),maxY:Math.max(b,c)});f=!0},findNearestSignedDistance:function(f,b){l();for(var a=Infinity,c=Infinity,d=u.length;d--;){var e=u[d];if(e.maxX+c<=f)break;if(f+c>e.minX&&b-c<e.maxY&&b+c>e.minY){var g=e.x0;var h=e.y0;var k=e.x1-g;e=e.y1-h;var m=k*k+e*e;m=m?Math.max(0,Math.min(1,
((f-g)*k+(b-h)*e)/m)):0;g=f-(g+m*k);h=b-(h+m*e);h=g*g+h*h;h<a&&(a=h,c=Math.sqrt(a))}}l();a=!1;for(d=u.length;d--;){h=u[d];if(h.maxX<=f)break;h.minY<b&&h.maxY>b&&h.y0>b!==h.y1>b&&f<(h.x1-h.x0)*(b-h.y0)/(h.y1-h.y0)+h.x0&&(a=!a)}a&&(c=-c);return c}}},function(l,f){var u=f.sdfExponent,m=f.sdfMargin;return function(b,a){var c=new Uint8Array(a*a),d=b.xMax-b.xMin,e=b.yMax-b.yMin,g=Math.max(d,e),f=Math.max(d,e)/a*(m*a+.5);d=b.xMin-f;e=b.yMin-f;var k=b.xMax+f;f=b.yMax+f;var q=k-d,z=f-e,B=Math.max(q,z);if(b.pathCommandCount){var p=
l(b),n,r,t,y;b.forEachPathCommand(function(a,b,c,d,e,g,f){switch(a){case "M":t=n=b;y=r=c;break;case "L":b===t&&c===y||p.addLineSegment(t,y,t=b,y=c);break;case "Q":g={x:t,y};for(f=1;16>f;f++){a=f/15;var h=1-a;a={x:h*h*t+2*h*a*b+a*a*d,y:h*h*y+2*h*a*c+a*a*e};p.addLineSegment(g.x,g.y,a.x,a.y);g=a}t=d;y=e;break;case "C":a={x:t,y};for(h=1;16>h;h++){var k=h/15;var l=1-k;k={x:l*l*l*t+3*l*l*k*b+3*l*k*k*d+k*k*k*g,y:l*l*l*y+3*l*l*k*c+3*l*k*k*e+k*k*k*f};p.addLineSegment(a.x,a.y,k.x,k.y);a=k}t=g;y=f;break;case "Z":t===
n&&y===r||p.addLineSegment(t,y,n,r)}});for(b=0;b<a;b++)for(var x=0;x<a;x++){var E=p.findNearestSignedDistance(d+q*(b+.5)/a,e+z*(x+.5)/a,g),D=Math.pow(1-Math.abs(E)/B,u)/2;0>E&&(D=1-D);D=Math.max(0,Math.min(255,Math.round(255*D)));c[x*a+b]=D}}return{textureData:c,renderingBounds:[d,e,k,f]}}},function(l,f,u,m){function b(a,b){function c(){var d=function(b){console.error("Failure loading font "+a+(a===k?"":"; trying fallback"),b);a!==k&&(a=k,c())};try{var e=new XMLHttpRequest;e.open("get",a,!0);e.responseType=
"arraybuffer";e.onload=function(){if(400<=e.status)d(Error(e.statusText));else if(0<e.status)try{var a=l(e.response);b(a)}catch(D){d(D)}};e.onerror=d;e.send()}catch(E){d(E)}}c()}function a(a,c){a||(a=k);var d=z[a];d?d.pending?d.pending.push(c):c(d):(z[a]={pending:[c]},b(a,function(b){var c=z[a].pending;z[a]=b;c.forEach(function(a){return a(b)})}))}function c(b,c,d){b||(b=k);var e=b+"@"+c,g=q[e];g?d(g):a(b,function(a){g=q[e]||(q[e]={fontObj:a,glyphs:{},glyphCount:0});d(g)})}function d(a,b,d){var l=
a.text;void 0===l&&(l="");var t=a.font;void 0===t&&(t=k);var p=a.sdfGlyphSize;void 0===p&&(p=64);var n=a.fontSize;void 0===n&&(n=1);var m=a.letterSpacing;void 0===m&&(m=0);var r=a.lineHeight;void 0===r&&(r="normal");var q=a.maxWidth;void 0===q&&(q=Infinity);var z=a.direction,F=a.textAlign;void 0===F&&(F="left");var v=a.textIndent;void 0===v&&(v=0);var w=a.whiteSpace;void 0===w&&(w="normal");var A=a.overflowWrap;void 0===A&&(A="normal");var G=a.anchorX;void 0===G&&(G=0);var S=a.anchorY;void 0===S&&
(S=0);var P=a.includeCaretPositions;void 0===P&&(P=!1);var L=a.chunkedBoundsSize;void 0===L&&(L=8192);var K=a.colorRanges;void 0===K&&(K=null);void 0===d&&(d=!1);var C=g(),H={total:0,fontLoad:0,layout:0,sdf:{},sdfTotal:0};-1<l.indexOf("\r")&&(console.warn("FontProcessor.process: got text with \\r chars; normalizing to \\n"),l=l.replace(/\r\n/g,"\n").replace(/\r/g,"\n"));n=+n;m=+m;q=+q;r=r||"normal";v=+v;c(t,p,function(a){var c=a.fontObj,k=isFinite(q),t=null,x=null,y=null,E=null,D=null,I=null,N=null,
J=0,O=0,ia="nowrap"!==w,V=c.ascender,Q=c.descender,R=c.unitsPerEm;H.fontLoad=g()-C;var aa=g(),M=n/R;"normal"===r&&(r=(V-Q)/R);r*=n;R=(r-(V-Q)*M)/2;var Y=-(V*M+R),fa=Math.min(r,(V-Q)*M),ja=(V+Q)/2*M-fa/2,ca=v,T=new h,da=[T];c.forEachGlyph(l,n,m,function(a,b,c){var d=l.charAt(c),e=a.advanceWidth*M,g=T.count;"isEmpty"in a||(a.isWhitespace=!!d&&/\s/.test(d),a.isEmpty=a.xMin===a.xMax||a.yMin===a.yMax||B.test(d));a.isWhitespace||a.isEmpty||O++;if(ia&&k&&!a.isWhitespace&&b+e+ca>q&&g){if(T.glyphAt(g-1).glyphObj.isWhitespace){var f=
new h;ca=-b}else for(;g--;)if(0===g&&"break-word"===A){f=new h;ca=-b;break}else if(T.glyphAt(g).glyphObj.isWhitespace){f=T.splitAt(g+1);g=f.glyphAt(0).x;ca-=g;for(var t=f.count;t--;)f.glyphAt(t).x-=g;break}f&&(T.isSoftWrapped=!0,T=f,da.push(T),J=q)}f=T.glyphAt(T.count);f.glyphObj=a;f.x=b+ca;f.width=e;f.charIndex=c;"\n"===d&&(T=new h,da.push(T),ca=-(b+e+m*n)+v)});da.forEach(function(a){for(var b=a.count;b--;){var c=a.glyphAt(b),d=c.x,e=c.width;if(!c.glyphObj.isWhitespace){a.width=d+e;a.width>J&&(J=
a.width);break}}});var Z=0,ea=0;G&&("number"===typeof G?Z=-G:"string"===typeof G&&(Z=-J*("left"===G?0:"center"===G?.5:"right"===G?1:e(G))));if(S)if("number"===typeof S)ea=-S;else if("string"===typeof S){var ma=da.length*r;ea="top"===S?0:"top-baseline"===S?-Y:"middle"===S?ma/2:"bottom"===S?ma:"bottom-baseline"===S?ma-R+Q*M:e(S)*ma}if(!d){var ha=u.getEmbeddingLevels(l,z);x=new Float32Array(4*O);y=new Float32Array(O);I=[Infinity,Infinity,-Infinity,-Infinity];N=[];var qa=Y;P&&(D=new Float32Array(3*l.length));
K&&(E=new Uint8Array(3*O));var ka=0,X=-1,na=-1,oa,pa;da.forEach(function(b,d){d=b.count;var e=b.width;if(0<d){for(var h=0,k=d;k--&&b.glyphAt(k).glyphObj.isWhitespace;)h++;var n=k=0;if("center"===F)k=(J-e)/2;else if("right"===F)k=J-e;else if("justify"===F&&b.isSoftWrapped){n=0;for(var m=d-h;m--;)b.glyphAt(m).glyphObj.isWhitespace&&n++;n=(J-e)/n}if(n||k)for(m=e=0;m<d;m++){var q=b.glyphAt(m),v=q.glyphObj;q.x+=k+e;0!==n&&v.isWhitespace&&m<d-h&&(e+=n,q.width+=n)}k=u.getReorderSegments(l,ha,b.glyphAt(0).charIndex,
b.glyphAt(b.count-1).charIndex);for(n=0;n<k.length;n++){e=k[n];v=e[0];q=e[1];e=Infinity;m=-Infinity;for(var w=0;w<d;w++)if(b.glyphAt(w).charIndex>=v){var z=w;for(v=w;v<d;v++){w=b.glyphAt(v);if(w.charIndex>q)break;v<d-h&&(e=Math.min(e,w.x),m=Math.max(m,w.x+w.width))}for(q=z;q<v;q++)z=b.glyphAt(q),z.x=m-(z.x+z.width-e);break}}h=function(a){return A=a};for(k=0;k<d;k++){e=b.glyphAt(k);var A=e.glyphObj;(n=ha.levels[e.charIndex]&1)&&(m=u.getMirroredCharacter(l[e.charIndex]))&&c.forEachGlyph(m,0,0,h);if(P){m=
e.charIndex;q=e.x+Z;v=e.x+e.width+Z;D[3*m]=n?v:q;D[3*m+1]=n?q:v;for(D[3*m+2]=qa+ja+ea;1<m-X;)D[3*(X+1)]=D[3*X],D[3*(X+1)+1]=D[3*X+1],D[3*(X+1)+2]=D[3*X+2],X++;X=m}if(K)for(n=e.charIndex;n>na;)na++,K.hasOwnProperty(na)&&(pa=K[na]);A.isWhitespace||A.isEmpty||(n=ka++,m=a.glyphs[A.index],m||(m=g(),q=f(A,p),H.sdf[l.charAt(e.charIndex)]=g()-m,q.atlasIndex=a.glyphCount++,t||(t=[]),t.push(q),m=a.glyphs[A.index]={atlasIndex:q.atlasIndex,glyphObj:A,renderingBounds:q.renderingBounds}),q=m.renderingBounds,v=
4*n,z=e.x+Z,e=qa+ea,x[v]=z+q[0]*M,x[v+1]=e+q[1]*M,x[v+2]=z+q[2]*M,x[v+3]=e+q[3]*M,q=z+A.xMin*M,v=e+A.yMin*M,z+=A.xMax*M,e+=A.yMax*M,q<I[0]&&(I[0]=q),v<I[1]&&(I[1]=v),z>I[2]&&(I[2]=z),e>I[3]&&(I[3]=e),0===n%L&&(oa={start:n,end:n,rect:[Infinity,Infinity,-Infinity,-Infinity]},N.push(oa)),oa.end++,w=oa.rect,q<w[0]&&(w[0]=q),v<w[1]&&(w[1]=v),z>w[2]&&(w[2]=z),e>w[3]&&(w[3]=e),y[n]=m.atlasIndex,K&&(n*=3,E[n]=pa>>16&255,E[n+1]=pa>>8&255,E[n+2]=pa&255))}}qa-=r})}for(var la in H.sdf)H.sdfTotal+=H.sdf[la];H.layout=
g()-aa-H.sdfTotal;H.total=g()-C;b({glyphBounds:x,glyphAtlasIndices:y,caretPositions:D,caretHeight:fa,glyphColors:E,chunkedBounds:N,ascender:V*M,descender:Q*M,lineHeight:r,topBaseline:Y,blockBounds:[Z,ea-da.length*r,Z+J,ea],visibleBounds:I,newGlyphSDFs:t,timings:H})})}function e(a){a=(a=a.match(/^([\d.]+)%$/))?parseFloat(a[1]):NaN;return isNaN(a)?0:a/100}function g(){return(self.performance||Date).now()}function h(){this.data=[]}var k=m.defaultFontURL,q=Object.create(null),z=Object.create(null),B=
/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,p=["glyphObj","x","width","charIndex"];h.prototype={width:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/p.length)},glyphAt:function(a){var b=h.flyweight;b.data=this.data;b.index=a;return b},splitAt:function(a){var b=new h;b.data=this.data.splice(a*p.length);return b}};h.flyweight=p.reduce(function(a,b,c,d){Object.defineProperty(a,b,{get:function(){return this.data[this.index*
p.length+c]},set:function(a){this.data[this.index*p.length+c]=a}});return a},{data:null,index:0});return{process:d,measure:function(a,b){d(a,function(a){a=a.blockBounds;b({width:a[2]-a[0],height:a[3]-a[1]})},{metricsOnly:!0})},loadFont:a}},K["default"]],init:function(l,f,u,m,b,a){var c=l.defaultFontURL;l=m(u,{sdfExponent:l.sdfExponent,sdfMargin:l.sdfMargin});return b(f,l,a(),{defaultFontURL:c})}});var wa=Q.defineWorkerModule({name:"TextBuilder",dependencies:[K,Q.ThenableWorkerModule],init:function(l,
f){return function(u){var m=new f;l.process(u,m.resolve);return m}},getTransferables:function(l){var f=[l.glyphBounds.buffer,l.glyphAtlasIndices.buffer];l.caretPositions&&f.push(l.caretPositions.buffer);l.newGlyphSDFs&&l.newGlyphSDFs.forEach(function(l){f.push(l.textureData.buffer)});return f}}),sa=function(){function l(a){var b=m[a];b||(b=m[a]=(new B.PlaneBufferGeometry(1,1,a,a)).translate(.5,.5,0));return b}function f(a,b,d,e){var c=a.getAttribute(b);d?c&&c.array.length===d.length?(c.array.set(d),
c.needsUpdate=!0):(a.setAttribute(b,new B.InstancedBufferAttribute(d,e)),delete a._maxInstanceCount,a.dispose()):c&&a.deleteAttribute(b)}function u(a,b){a[a.hasOwnProperty("instanceCount")?"instanceCount":"maxInstancedCount"]=b}var m={};new B.Vector3;var b=function(a){function b(){a.call(this);this.detail=1;this.curveRadius=0;this.groups=[{start:0,count:Infinity,materialIndex:0},{start:0,count:Infinity,materialIndex:1}];this.boundingSphere=new B.Sphere;this.boundingBox=new B.Box3}a&&(b.__proto__=
a);b.prototype=Object.create(a&&a.prototype);b.prototype.constructor=b;var d={detail:{configurable:!0},curveRadius:{configurable:!0}};b.prototype.computeBoundingSphere=function(){};b.prototype.computeBoundingBox=function(){};d.detail.set=function(a){var b=this;if(a!==this._detail){this._detail=a;if("number"!==typeof a||1>a)a=1;var c=l(a);["position","normal","uv"].forEach(function(a){b.attributes[a]=c.attributes[a].clone()});this.setIndex(c.getIndex().clone())}};d.detail.get=function(){return this._detail};
d.curveRadius.set=function(a){a!==this._curveRadius&&(this._curveRadius=a,this._updateBounds())};d.curveRadius.get=function(){return this._curveRadius};b.prototype.updateGlyphs=function(a,b,c,d,l){f(this,"aTroikaGlyphBounds",a,4);f(this,"aTroikaGlyphIndex",b,1);f(this,"aTroikaGlyphColor",l,3);this._blockBounds=c;this._chunkedBounds=d;u(this,b.length);this._updateBounds()};b.prototype._updateBounds=function(){var a=this._blockBounds;if(a){var b=this.curveRadius,c=this.boundingBox;if(b){var d=Math.PI,
f=Math.floor,l=Math.min,m=Math.max,p=Math.sin,n=Math.cos,r=d/2,t=2*d,y=Math.abs(b),x=a[0]/y,u=a[2]/y;l=f((x+r)/t)!==f((u+r)/t)?-y:l(p(x)*y,p(u)*y);p=f((x-r)/t)!==f((u-r)/t)?y:m(p(x)*y,p(u)*y);d=f((x+d)/t)!==f((u+d)/t)?2*y:m(y-n(x)*y,y-n(u)*y);c.min.set(l,a[1],0>b?-d:0);c.max.set(p,a[3],0>b?0:d)}else c.min.set(a[0],a[1],0),c.max.set(a[2],a[3],0);c.getBoundingSphere(this.boundingSphere)}};b.prototype.applyClipRect=function(a){var b=this.getAttribute("aTroikaGlyphIndex").count,c=this._chunkedBounds;
if(c)for(var d=c.length;d--;){b=c[d].end;var e=c[d].rect;if(e[1]<a.w&&e[3]>a.y&&e[0]<a.z&&e[2]>a.x)break}u(this,b)};Object.defineProperties(b.prototype,d);return b}(B.InstancedBufferGeometry);b.prototype.setAttribute||(b.prototype.setAttribute=function(a,b){this.attributes[a]=b;return this});return b}();Q=function(){function l(a){return Array.isArray(a)?a[0]:a}var f=new B.MeshBasicMaterial({color:16777215,side:B.DoubleSide,transparent:!0}),u=new B.Matrix4,m=new B.Vector3,b=new B.Vector3,a=[],c=new B.Vector3,
d=function(){var a=new B.Mesh(new B.PlaneBufferGeometry(1,1),f);d=function(){return a};return a},e=function(){var a=new B.Mesh(new B.PlaneBufferGeometry(1,1,32,1),f);e=function(){return a};return a},g={type:"syncstart"},h={type:"synccomplete"},k="font fontSize letterSpacing lineHeight maxWidth overflowWrap text direction textAlign textIndent whiteSpace anchorX anchorY colorRanges sdfGlyphSize".split(" "),q=k.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail"),
z=function(k){function n(){var a=new sa;k.call(this,a,null);this.text="";this.curveRadius=this.anchorY=this.anchorX=0;this.direction="auto";this.font=null;this.fontSize=.1;this.letterSpacing=0;this.lineHeight="normal";this.maxWidth=Infinity;this.overflowWrap="normal";this.textAlign="left";this.textIndent=0;this.whiteSpace="normal";this.colorRanges=this.color=this.material=null;this.outlineColor=this.outlineWidth=0;this.outlineOpacity=1;this.strokeWidth=this.outlineOffsetY=this.outlineOffsetX=this.outlineBlur=
0;this.strokeColor=8421504;this.fillOpacity=this.strokeOpacity=1;this.depthOffset=0;this.clipRect=null;this.orientation="+x+y";this.glyphGeometryDetail=1;this.sdfGlyphSize=null;this.debugSDF=!1}k&&(n.__proto__=k);n.prototype=Object.create(k&&k.prototype);n.prototype.constructor=n;var p={textRenderInfo:{configurable:!0},material:{configurable:!0},glyphGeometryDetail:{configurable:!0},curveRadius:{configurable:!0},customDepthMaterial:{configurable:!0},customDistanceMaterial:{configurable:!0}};n.prototype.sync=
function(a){var b=this;this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(a):(this._isSyncing=!0,this.dispatchEvent(g),ja({text:this.text,font:this.font,fontSize:this.fontSize||.1,letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,
colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize},function(c){b._isSyncing=!1;b._textRenderInfo=c;b.geometry.updateGlyphs(c.glyphBounds,c.glyphAtlasIndices,c.blockBounds,c.chunkedBounds,c.glyphColors);var d=b._queuedSyncs;d&&(b._queuedSyncs=null,b._needsSync=!0,b.sync(function(){d.forEach(function(a){return a&&a()})}));b.dispatchEvent(h);a&&a()})))};n.prototype.onBeforeRender=function(a,b,c,d,e,f){this.sync();e.isTroikaTextMaterial&&this._prepareForRender(e)};n.prototype.dispose=
function(){this.geometry.dispose()};p.textRenderInfo.get=function(){return this._textRenderInfo||null};p.material.get=function(){var a=this._derivedMaterial,b=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=f.clone());a&&a.baseMaterial===b||(a=this._derivedMaterial=la(b),b.addEventListener("dispose",function D(){b.removeEventListener("dispose",D);a.dispose()}));if(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY){var c=a._outlineMtl;c||(c=a._outlineMtl=
Object.create(a,{id:{value:a.id+.1}}),c.isTextOutlineMaterial=!0,c.depthWrite=!1,c.map=null,a.addEventListener("dispose",function D(){a.removeEventListener("dispose",D);c.dispose()}));return[c,a]}return a};p.material.set=function(a){a&&a.isTroikaTextMaterial?(this._derivedMaterial=a,this._baseMaterial=a.baseMaterial):this._baseMaterial=a};p.glyphGeometryDetail.get=function(){return this.geometry.detail};p.glyphGeometryDetail.set=function(a){this.geometry.detail=a};p.curveRadius.get=function(){return this.geometry.curveRadius};
p.curveRadius.set=function(a){this.geometry.curveRadius=a};p.customDepthMaterial.get=function(){return l(this.material).getDepthMaterial()};p.customDistanceMaterial.get=function(){return l(this.material).getDistanceMaterial()};n.prototype._prepareForRender=function(a){var d=a.isTextOutlineMaterial,e=a.uniforms,f=this.textRenderInfo;if(f){var g=f.sdfTexture,h=f.blockBounds;e.uTroikaSDFTexture.value=g;e.uTroikaSDFTextureSize.value.set(g.image.width,g.image.height);e.uTroikaSDFGlyphSize.value=f.sdfGlyphSize;
e.uTroikaSDFExponent.value=f.sdfExponent;e.uTroikaTotalBounds.value.fromArray(h);e.uTroikaUseGlyphColors.value=!d&&!!f.glyphColors;var k=f=0;g=0;var l=0,n=0;if(d){l=this.outlineOffsetX;n=this.outlineOffsetY;k=this.outlineBlur;var p=this.outlineOpacity;f=this._parsePercent(this.outlineWidth)||0;k=Math.max(0,this._parsePercent(k)||0);l=this._parsePercent(l)||0;n=this._parsePercent(n)||0}else{if(g=Math.max(0,this._parsePercent(this.strokeWidth)||0)){var q=this.strokeColor;e.uTroikaStrokeColor.value.set(null==
q?8421504:q);q=this.strokeOpacity;null==q&&(q=1)}p=this.fillOpacity}e.uTroikaDistanceOffset.value=f;e.uTroikaPositionOffset.value.set(l,n);e.uTroikaBlurRadius.value=k;e.uTroikaStrokeWidth.value=g;e.uTroikaStrokeOpacity.value=q;e.uTroikaFillOpacity.value=null==p?1:p;e.uTroikaCurveRadius.value=this.curveRadius||0;(q=this.clipRect)&&Array.isArray(q)&&4===q.length?e.uTroikaClipRect.value.fromArray(q):(q=100*(this.fontSize||.1),e.uTroikaClipRect.value.set(h[0]-q,h[1]-q,h[2]+q,h[3]+q));this.geometry.applyClipRect(e.uTroikaClipRect.value)}e.uTroikaSDFDebug.value=
!!this.debugSDF;a.polygonOffset=!!this.depthOffset;a.polygonOffsetFactor=a.polygonOffsetUnits=this.depthOffset||0;d=d?this.outlineColor||0:this.color;null==d?delete a.color:(h=a.hasOwnProperty("color")?a.color:a.color=new B.Color,(d!==h._input||"object"===typeof d)&&h.set(h._input=d));d=this.orientation||"+x+y";d!==a._orientation&&(e=e.uTroikaOrient.value,d=d.replace(/[^-+xyz]/g,""),(g="+x+y"!==d&&d.match(/^([-+])([xyz])([-+])([xyz])$/))?(h=g[1],q=g[2],f=g[3],g=g[4],m.set(0,0,0)[q]="-"===h?1:-1,b.set(0,
0,0)[g]="-"===f?-1:1,u.lookAt(c,m.cross(b),b),e.setFromMatrix4(u)):e.identity(),a._orientation=d)};n.prototype._parsePercent=function(a){"string"===typeof a&&(a=(a=a.match(/^(-?[\d.]+)%$/))?parseFloat(a[1]):NaN,a=(isNaN(a)?0:a/100)*this.fontSize);return a};n.prototype.localPositionToTextCoords=function(a,b){void 0===b&&(b=new B.Vector2);b.copy(a);var c=this.curveRadius;c&&(b.x=Math.atan2(a.x,Math.abs(c)-Math.abs(a.z))*Math.abs(c));return b};n.prototype.worldPositionToTextCoords=function(a,b){void 0===
b&&(b=new B.Vector2);m.copy(a);return this.localPositionToTextCoords(this.worldToLocal(m),b)};n.prototype.raycast=function(b,c){var f=this.textRenderInfo,g=this.curveRadius;if(f){f=f.blockBounds;var h=g?e():d(),k=h.geometry,l=k.attributes,m=l.position;l=l.uv;for(var n=0;n<l.count;n++){var p=f[0]+l.getX(n)*(f[2]-f[0]),q=f[1]+l.getY(n)*(f[3]-f[1]),r=0;g&&(r=g-Math.cos(p/g)*g,p=Math.sin(p/g)*g);m.setXYZ(n,p,q,r)}k.boundingSphere=this.geometry.boundingSphere;k.boundingBox=this.geometry.boundingBox;h.matrixWorld=
this.matrixWorld;h.material.side=this.material.side;a.length=0;h.raycast(b,a);for(b=0;b<a.length;b++)a[b].object=this,c.push(a[b])}};n.prototype.copy=function(a){var b=this,c=this.geometry;k.prototype.copy.call(this,a);this.geometry=c;q.forEach(function(c){b[c]=a[c]});return this};n.prototype.clone=function(){return(new this.constructor).copy(this)};Object.defineProperties(n.prototype,p);return n}(B.Mesh);k.forEach(function(a){var b="_private_"+a;Object.defineProperty(z.prototype,a,{get:function(){return this[b]},
set:function(a){a!==this[b]&&(this[b]=a,this._needsSync=!0)}})});var F=!1;Object.defineProperty(z.prototype,"anchor",{get:function(){return this._deprecated_anchor},set:function(a){this._deprecated_anchor=a;F||(console.warn("TextMesh: `anchor` has been deprecated; use `anchorX` and `anchorY` instead."),F=!0);Array.isArray(a)?(this.anchorX=100*(+a[0]||0)+"%",this.anchorY=100*(+a[1]||0)+"%"):this.anchorX=this.anchorY=0}});return z}();var ta=new WeakMap,ra=new WeakMap;F.GlyphsGeometry=sa;F.Text=Q;F.configureTextBuilder=
function(l){ha?console.warn("configureTextBuilder called after first font request; will be ignored."):ka(R,l)};F.createTextDerivedMaterial=la;F.dumpSDFTextures=function(){Object.keys(aa).forEach(function(l){var f=aa[l],u=document.createElement("canvas"),m=f.sdfTexture.image,b=m.width,a=m.height;m=m.data;u.width=b;u.height=a;m=new ImageData(new Uint8ClampedArray(m),b,a);u.getContext("2d").putImageData(m,0,0);console.log(l,f,u.toDataURL());console.log("%c.","\n      background: url("+u.toDataURL()+
");\n      background-size: "+b+"px "+a+"px;\n      color: transparent;\n      font-size: 0;\n      line-height: "+a+"px;\n      padding-left: "+b+"px;\n    ")})};F.fontProcessorWorkerModule=K;F.getCaretAtPoint=function(l,f,u){var m=null,b=l.caretHeight;l=xa(l);var a=Infinity;l.forEach(function(c,d){Math.abs(u-(d+b/2))<Math.abs(u-(a+b/2))&&(a=d)});l.get(a).forEach(function(a){if(!m||Math.abs(f-a.x)<Math.abs(f-m.x))m=a});return m};F.getSelectionRects=function(l,f,u){var m;if(l){if((m=ta.get(l))&&m.start===
f&&m.end===u)return m.rects;var b=l.caretPositions,a=l.caretHeight;u<f&&(m=f,f=u,u=m);f=Math.max(f,0);u=Math.min(u,b.length+1);m=[];for(var c=null,d=f;d<u;d++){var e=b[3*d],g=b[3*d+1],h=Math.min(e,g);e=Math.max(e,g);g=b[3*d+2];if(!c||g!==c.bottom||h>c.right||e<c.left)c={left:Infinity,right:-Infinity,bottom:g,top:g+a},m.push(c);c.left=Math.min(h,c.left);c.right=Math.max(e,c.right)}m.sort(function(a,b){return b.bottom-a.bottom||a.left-b.left});for(b=m.length-1;0<b--;)a=m[b],c=m[b+1],a.bottom===c.bottom&&
a.left<=c.right&&a.right>=c.left&&(c.left=Math.min(c.left,a.left),c.right=Math.max(c.right,a.right),m.splice(b,1));ta.set(l,{start:f,end:u,rects:m})}return m};F.preloadFont=function(l,f){var u=l.font,m=l.characters;l=l.sdfGlyphSize;m=Array.isArray(m)?m.join("\n"):""+m;ja({font:u,sdfGlyphSize:l,text:m},f)};Object.defineProperty(F,"__esModule",{value:!0})})
